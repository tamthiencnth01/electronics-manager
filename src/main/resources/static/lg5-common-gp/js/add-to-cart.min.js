// 20200611 START ë°•́§€́˜ - addToCart ë¥¼ ́ „́—­ë³€́ˆ˜ë¡œ ë³€ê²½
var OBS,addToCart,ga360Init,_salesModelCode,_modelCode,ga360CompareInit,ga360SearchInit,ga360plpInit,reStockAlert;$(document).ready(function(){var r;console.log("add-to-cart.js","OBS_LOGIN_FLAG : ",OBS_LOGIN_FLAG),_salesModelCode=void 0===_dl.products||void 0===_dl.products[0]?"":_dl.products[0].sales_model_code,_modelCode=void 0===_dl.products||void 0===_dl.products[0]?"":_dl.products[0].model_code;var c=$(".GPC0009"),h={changeCartUrl:function(a){var e;!a||(e=addToCart.$nav.find(".for-desktop .right-btm .icons .cart a").attr("href"))&&(e=-1!=e.indexOf("?")?e.split("?")[0]+"?cartId="+a:e+"?cartId="+a,addToCart.$nav.find(".for-mobile .right .cart a, .for-desktop .right-btm .icons .cart a").attr("href",e))},checkLogin:function(){var a=!1;return 0<addToCart.$nav.find(".logged .after-login").length&&(a=!0),a},getToken:function(){return sessionStorage.getItem("ACCESS_TOKEN")},createEmptyCart:function(e){var a=h.getToken(),t=addToCart.url,d={};""!=a&&(d.Authorization="Bearer "+a),d.Store=addToCart.store,d["Content-type"]="application/json";var o=c.find("#pin-modelId").val(),r="";0<$(".add-to-cart").length&&(r=$(".add-to-cart:eq(0)")),$.ajax({url:t,headers:d,type:"post",data:JSON.stringify({query:"mutation {createEmptyCart}",variables:null,operationName:null}),dataType:"json",success:function(a){addToCart.cartID=a.data.createEmptyCart,setCookie(addToCart.cookieName,addToCart.cartID,!0),addToCart.cartID&&h.changeCartUrl(addToCart.cartID),o?0<c.find(".check-good").length?h.addProductToCart(e,1,addToCart.cartID,!0,r):(0<c.find(".checkAvailable").length?($("#comunaRegionId").trigger("chosen:activate"),c.find(".check-region").focus()):(0<c.find(".delivery-list .option-list").length&&$("#pinCodeList").trigger("chosen:activate"),c.find(".check-pincode").focus()),$("body").trigger("ajaxLoadEnd")):"Y"==$(".addtocart-datelayer-use-flag").val()?h.addProductToCart(e,1,addToCart.cartID,!0,r):e&&h.addProductToCart(e,1,addToCart.cartID)},error:function(a,e,t){}})},addProductToCart:function(p,a,g,f,v){if(!p)return!1;for(var e=p.split(","),t=[],d=1;d<e.length;d++)t[d-1]=e[d].trim();var o=h.getToken(),r=addToCart.url,i={};""!=o&&(i.Authorization="Bearer "+o),i.Store=addToCart.store,i["Content-type"]="application/json",$.ajax({url:r,headers:i,type:"post",data:JSON.stringify({query:'mutation { addModelToCart(input: { cart_id: "'+g+'", cartItems: [ { data: { sku: "'+e[0]+'", qty: '+a+'}, package_item_id: "'+t+'" } ] }) {redirectUrl cart { items { product { sku } qty}}}}',variables:null,operationName:null}),dataType:"json",success:function(a){if(a.errors)if(-1!=a.errors[0].message.indexOf("Could not find a cart with ID")||-1!=a.errors[0].message.indexOf("The current user cannot perform operations on cart"))h.createEmptyCart(p);else{for(var e="",t=0;t<a.errors.length;t++)e+=a.errors[t].message;0<$("#addToCartError").length&&$("#addToCartError").remove();var d='<div class="modal modal-simple fade" id="addToCartError" tabindex="-1" role="dialog" data-backdrop="false" aria-label="Fail to add Cart" aria-describedby="addToCartFailDialog"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-body"><div class="simple-content-box"><div class="content-paragraph" id="addToCartFailDialog">'+e+'</div></div></div><div class="modal-footer"><button type="button" class="btn btn-primary" data-dismiss="modal">'+addToCart.successBtnClose+"</button></div></div></div></div>";$("body").append(d),$("#addToCartError").modal(),$("#addToCartError").find("button[data-dismiss=modal]").on("click.close",function(){addToCart.currentFocus()})}else{var o,r,i,n=a.data.addModelToCart.cart.items,s=n.length;if(0<s&&(o=a.data.addModelToCart.cart.items[s-1].product.sku,"function"==typeof OBS.addCookieValue&&OBS.addCookieValue("CART",o)),f&&(i=new Object,r=new Array,0<addToCart.$nav.find(".logged .after-login").length&&(ga360Init.cartID=g,i.dimension108=o),i.id=ga360Init.sku,i.name=ga360Init.name,d=C(ga360Init.price,"0"),i.price=d,i.brand=ga360Init.std_lv2,i.category=ga360Init.std_lv1,void 0!==ga360Init.name&&(i.variant=-1==ga360Init.name.indexOf(".")?null:ga360Init.name.substring(ga360Init.name.indexOf(".")+1,ga360Init.name.length)),0<s&&(i.quantity=1),i.dimension124=ga360Init.std_lv3,i.dimension125=ga360Init.superCategory,i.dimension126=ga360Init.modelCode,i.dimension127=ga360Init.displayName,ga360Init.ecommerce.currencyCode=ga360Init.currencyCode,i.dimension185=ga360Init.obsGroup,i.metric4=ga360Init.metric4,i.cart_btn=ga360Init.cart_btn,r.push(i),ga360Init.ecommerce.add=new Object,ga360Init.ecommerce.add.products=r,ga360Init.addData(),ga360Init.cartID.add,o=$(this).data("model-id"),u=$(v).closest(".button").find(".pre-order"),d=$("#navigation_search"),i="","others"==(r=_dl.page_name.page_purpose)||"search"==r||"compare"==r?i=r:0<d.length?i="navigation search":0<$(v).closest(".component").length&&(i=$(v).closest(".component").attr("class").split(" ")[1]),0<$(".GPC0009").length?(d=$(".GPC0009").data("product-id"),0<u.length?(m=$(v).data("obs-pre-order-start-date")+" - "+$(v).data("obs-pre-order-end-date"),adobeTrackEvent("pre-order",{products:[{sales_model_code:findSalesModel($(v)),model_name:findModelName($(v)),value_added_to_cart:findPrice($(v)),units_added_to_cart:findModelCount($(v))}],component_id:i,pre_order_period:m,page_event:{pre_order:!0}})):d!=o?adobeTrackEvent("add-to-cart",{products:[{sales_model_code:findSalesModel($(v)),model_name:findModelName($(v)),value_added_to_cart:findPrice($(v)),units_added_to_cart:findModelCount($(v))}],cross_sell_product:d,page_event:{add_to_cart:!0}}):adobeTrackEvent("add-to-cart",{products:[{sales_model_code:findSalesModel($(v)),model_name:findModelName($(v)),value_added_to_cart:findPrice($(v)),units_added_to_cart:findModelCount($(v))}],page_event:{add_to_cart:!0}})):0<u.length?(m=$(v).data("obs-pre-order-start-date")+" - "+$(v).data("obs-pre-order-end-date"),adobeTrackEvent("pre-order",{products:[{sales_model_code:findSalesModel($(v)),model_name:findModelName($(v)),value_added_to_cart:findPrice($(v)),units_added_to_cart:findModelCount($(v))}],component_id:i,pre_order_period:m,page_event:{pre_order:!0}})):adobeTrackEvent("add-to-cart",{products:[{sales_model_code:findSalesModel($(v)),model_name:findModelName($(v)),value_added_to_cart:findPrice($(v)),units_added_to_cart:findModelCount($(v))}],page_event:{add_to_cart:!0}})),a.data.addModelToCart.redirectUrl)location.href=a.data.addModelToCart.redirectUrl;else{var c=0;if(0<s)for(var l=0;l<s;l++)c+=parseInt(n[l].qty);addToCart.setCartNum(c);var u,m="",m=0<(u=$(v).closest(".button").find(".pre-order")).length?addToCart.preOrderSuccessMsg:addToCart.successMsg;null==addToCart.successHTML&&m&&addToCart.successBtnAlert&&m&&addToCart.successBtnClose&&("N"==ePrivacyCookies.bannerType||"I"==ePrivacyCookies.bannerType?addToCart.successHTML='<div class="modal modal-simple fade" id="addToCartSuccess" tabindex="-1" role="dialog" data-backdrop="false" aria-label="Add to Cart" aria-describedby="addToCartSuccessDialog"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-body"><div class="simple-content-box"><div class="content-paragraph" id="addToCartSuccessDialog">'+m+'</div></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">'+addToCart.successBtnClose+'</button><a href="'+xssfilter(addToCart.$nav.find(".cart a").attr("href"))+'" class="btn btn-primary btn-height">'+addToCart.successBtnAlert+"</a></div></div></div></div>":addToCart.successHTML='<div class="modal modal-simple fade" id="addToCartSuccess" tabindex="-1" role="dialog" data-backdrop="false" aria-label="Add to Cart" aria-describedby="addToCartSuccessDialog"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-body"><div class="simple-content-box"><div class="content-paragraph" id="addToCartSuccessDialog">'+m+'</div></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">'+addToCart.successBtnClose+'</button><a href="'+xssfilter(addToCart.$nav.find(".cart a").attr("href"))+'" class="btn btn-primary btn-height">'+addToCart.successBtnAlert+'</a></div><div class="simple-content-box"><div class="notice" style="display:inline-block;">'+addToCart.cookieNotice+"</div></div></div></div></div>"),null!=addToCart.successHTML&&(0<$("#addToCartSuccess").length&&$("#addToCartSuccess").remove(),$("body").append(addToCart.successHTML),$("#addToCartSuccess").modal(),$("#addToCartSuccess").find("button[data-dismiss=modal]").on("click.close",function(){addToCart.currentFocus()}))}}$("body").trigger("ajaxLoadEnd")},error:function(a,e,t){$("body").trigger("ajaxLoadEnd")}})},getGNBCart:function(){var a,e,t=addToCart.$nav.data("cart-check");t&&addToCart.cartID&&(e={},""!=(a=h.getToken())&&(e.Authorization="Bearer "+a),e.Store=addToCart.$nav.data("store"),e["Content-type"]="application/json",$.ajax({url:t,headers:e,type:"post",data:JSON.stringify({query:'{cart(cart_id: "'+addToCart.cartID+'") { items { product {  sku name } qty } }}',variables:null,operationName:null}),dataType:"json",success:function(a){if(a.errors)-1==a.errors[0].message.indexOf("Could not find a cart with ID")&&-1==a.errors[0].message.indexOf("The current user cannot perform operations on cart")||h.createEmptyCart();else{var e=a.data.cart.items.length,t=0;if(0<e){for(var d=0;d<e;d++)t+=parseInt(a.data.cart.items[d].qty);addToCart.setCartNum(t)}}},error:function(a,e,t){}}))},checkSale:function(a,e,t){var d=addToCart.url,n=$("html").data("countrycode").toUpperCase(),s="<span class='check-fail'>"+c.find("#pinValid").val()+"</span>",o=null,r={};r.Store=addToCart.$nav.data("store"),r["Content-type"]="application/json",o="AU"==n?JSON.stringify({query:'{AuCheckSale(sku: "'+a+'", qty: '+e+', postcode: "'+t+'") {message, deliveryLeadTime}}',variables:null}):JSON.stringify({query:'{checkSale(sku: "'+a+'", qty: '+e+", pincode: "+t+") {message, deliveryLeadTime}}",variables:null}),(0<c.find(".check-fail").length||0<c.find(".check-good").length)&&c.find(".check-fail").remove(),c.find(".check-good").remove(),$.ajax({url:d,headers:r,type:"post",data:o,dataType:"json",success:function(a){var e,t,d,o,r,i=null;a.errors?(c.find(".delivery-list .error-msg").show().append($(s)),0<$(".GPC0010").length&&($('.GPC0010 .products-list-wrap input[type="checkbox"]').attr("disabled",!0).prop("checked",!1),$('.GPC0010 .products-list-wrap input[type="radio"]').attr("disabled",!0).prop("checked",!1),packageComponent.sumPrice())):""!=(i="AU"==n?a.data.AuCheckSale:a.data.checkSale).deliveryLeadTime&&null!=i.deliveryLeadTime&&"undefined"!=i.deliveryLeadTime&&"number"==typeof i.deliveryLeadTime?((r=new Date).setDate(r.getDate()+i.deliveryLeadTime),e=r.getDate(),t=["January","February","March","April","May","June","July","August","September","October","November","December"][r.getMonth()],d=c.find("#pinCodeList").val(),o=c.find("#pinOK").val(),a=c.find("#pinSuccessMsg").val(),r=c.find("#pinChangeMsg").val(),r="<div class='check-good'>"+("<p class='pincode-ok'>"+o+"</p>")+"<p>"+a.replace(/\*dateplus\*/g,e).replace(/\*month\*/g,t).replace(/\*noMessage\*/g,"")+"</p><a href='#' role='button'><span>"+r+"</span></a></div>",c.find(".delivery-list .error-msg").show().append($(r)),(0<c.find(".delivery-list .option-list").length?c.find(".option-list"):c.find(".check-pincode")).hide(),c.find(".chkStBox a.btn-sm").hide(),c.find(".add-to-cart").attr({"data-link-area":"pdp_main-btn","data-link-name":"add_to_cart"}),$(".GPC0011").find(".button .add-to-cart").attr({"data-link-area":"pdp_tab_anchor-tab","data-link-name":"add_to_cart"}),c.find(".check-good a").on("click",function(a){a.preventDefault(),c.find(".check-good").remove(),c.find(".delivery-list .error-msg").hide(),0<c.find(".delivery-list .option-list").length?(c.find(".option-list").show(),$(d).trigger("chosen:activate"),c.find(".check-pincode").focus(),c.find(".pdp-info.desktop-info .chosen-initialized").hide()):c.find(".check-pincode").val("").show().focus(),c.find(".chkStBox a.btn-sm").show(),c.find(".add-to-cart").removeAttr("data-link-area"),c.find(".add-to-cart").removeAttr("data-link-name"),$(".GPC0011").find(".button .add-to-cart").removeAttr("data-link-area"),$(".GPC0011").find(".button .add-to-cart").removeAttr("data-link-name")}),0<$(".GPC0010").length&&($('.GPC0010 .products-list-wrap input[type="checkbox"]').removeAttr("disabled"),$('.GPC0010 .products-list-wrap input[type="radio"]').removeAttr("disabled"))):("Error"==i.message?c.find(".delivery-list .error-msg").show().append($(s)):(i="<span class='check-fail'>"+i.message+"</span>",c.find(".delivery-list .error-msg").show().append($(i))),0<$(".GPC0010").length&&($('.GPC0010 .products-list-wrap input[type="checkbox"]').attr("disabled",!0).prop("checked",!1),$('.GPC0010 .products-list-wrap input[type="radio"]').attr("disabled",!0).prop("checked",!1),packageComponent.sumPrice())),$("body").trigger("ajaxLoadEnd")},error:function(a,e,t){console.log("checkSale code:"+a.status+"\nmessage:"+a.responseText+"\nerror:"+t),c.find(".delivery-list .error-msg").show().append($(s)),$("body").trigger("ajaxLoadEnd")}})},comunaChange:function(a){var e=$(a.currentTarget),a=e.serialize(),e=e.data("url");$(".checkAvailable a.btn-sm").addClass("disabled"),c.find(".add-to-cart").addClass("disabled"),(0<c.find(".check-fail").length||0<c.find(".check-good").length)&&c.find(".check-fail").remove(),c.find(".check-good").remove(),$.ajax({type:"post",url:e,dataType:"json",data:a,success:function(a){if(a.result){var e,t=isMobile||$(window).width()<767?$(".check-comuna"):$("#comuna"),d=a.comunaList,o='<option value="" selected disabled>'+t.data("placeholder")+"</option>";for(e in d)o+='<option value="'+d[e].value+'">'+d[e].code+"</option>";t.html(o),t.prop("disabled",!1),t.trigger("chosen:updated"),t.on("change",function(a){$(".checkAvailable a.btn-sm").removeClass("disabled"),c.find(".add-to-cart").addClass("disabled"),(0<c.find(".check-fail").length||0<c.find(".check-good").length)&&c.find(".check-fail").remove(),c.find(".check-good").remove()})}},error:function(a,e,t){console.log("comunaChange code:"+a.status+"\nmessage:"+a.responseText+"\nerror:"+t)}})},checkComuna:function(a){var e=$("#comuna").data("comuna-url"),o=($("html").data("countrycode"),"<span class='check-fail'>"+c.find("#pinValid").val()+"</span>"),t={};t.Store=addToCart.$nav.data("store"),t["Content-type"]="application/json",(0<c.find(".check-fail").length||0<c.find(".check-good").length)&&c.find(".check-fail").remove(),c.find(".check-good").remove(),$.ajax({type:"post",url:e+"/"+a,dataType:"json",success:function(a){var e=a.available_shipping_message,t=a.delivery_day_message,d=a.add_to_cart,a="";1==d?(a="<div class='check-good'><p class='available-ok'>"+e+"<br>"+t+"</p></div>",$(".error-msg").append(a).show(),c.find(".add-to-cart").removeClass("disabled")):0==d?(a="<span class='check-fail'>"+e+"</span>",$(".error-msg").append(a).show()):$(".error-msg").append(o).show(),$("body").trigger("ajaxLoadEnd")},error:function(a,e,t){console.log("checkComuna code:"+a.status+"\nmessage:"+a.responseText+"\nerror:"+t),$(".error-msg").append(o).show(),c.find(".add-to-cart").addClass("disabled"),$("body").trigger("ajaxLoadEnd")}})}},i=function(t,a){if(!t)return!1;if(!$(".navigation").data("cart-add")||""==$(".navigation").data("cart-add"))return!1;h.getToken();$.ajax({url:$(".navigation").data("cart-add"),type:"post",data:{sku:t},xhrFields:{withCredentials:!0},dataType:"json",success:function(a){var e;1!=a.result?(e=a.message,0<$("#addToCartError").length&&$("#addToCartError").remove(),e='<div class="modal modal-simple fade" id="addToCartError" tabindex="-1" role="dialog" data-backdrop="false" aria-label="Fail to add Cart" aria-describedby="addToCartFailDialog"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-body"><div class="simple-content-box"><div class="content-paragraph" id="addToCartFailDialog">'+e+'</div></div></div><div class="modal-footer"><button type="button" class="btn btn-primary" data-dismiss="modal">Close</button></div></div></div></div>',$("body").append(e),$("#addToCartError").modal(),$("#addToCartError").find("button[data-dismiss=modal]").on("click.close",function(){addToCart.currentFocus()})):(e=addToCart.successMsg,a.message&&""!=a.message&&null!=a.message&&(e=a.message),"function"==typeof OBS.addCookieValue&&OBS.addCookieValue("CART",t),a=a.totalQty,addToCart.setCartNum(a),null==addToCart.successHTML&&e&&addToCart.successBtnAlert&&e&&addToCart.successBtnClose&&("N"==ePrivacyCookies.bannerType||"I"==ePrivacyCookies.bannerType?addToCart.successHTML='<div class="modal modal-simple fade" id="addToCartSuccess" tabindex="-1" role="dialog" data-backdrop="false" aria-label="Add to Cart" aria-describedby="addToCartSuccessDialog"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-body"><div class="simple-content-box"><div class="content-paragraph" id="addToCartSuccessDialog">'+e+'</div></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary btn-block" data-dismiss="modal">'+addToCart.successBtnClose+'</button><a href="'+xssfilter(addToCart.$nav.find(".cart a").attr("href"))+'" class="btn btn-primary btn-block">'+addToCart.successBtnAlert+"</a></div></div></div></div>":addToCart.successHTML='<div class="modal modal-simple fade" id="addToCartSuccess" tabindex="-1" role="dialog" data-backdrop="false" aria-label="Add to Cart" aria-describedby="addToCartSuccessDialog"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-body"><div class="simple-content-box"><div class="content-paragraph" id="addToCartSuccessDialog">'+e+'</div></div></div><div class="modal-footer"><button type="button" class="btn btn-secondary btn-block" data-dismiss="modal">'+addToCart.successBtnClose+'</button><a href="'+xssfilter(addToCart.$nav.find(".cart a").attr("href"))+'" class="btn btn-primary btn-block">'+addToCart.successBtnAlert+'</a></div><div class="simple-content-box"><div class="notice" style="display:inline-block;">'+addToCart.cookieNotice+"</div></div></div></div></div>"),null!=addToCart.successHTML&&(0<$("#addToCartSuccess").length&&$("#addToCartSuccess").remove(),$("body").append(addToCart.successHTML),$("#addToCartSuccess").modal(),$("#addToCartSuccess").find("button[data-dismiss=modal]").on("click.close",function(){addToCart.currentFocus()}))),$("body").trigger("ajaxLoadEnd")},error:function(a,e,t){$("body").trigger("ajaxLoadEnd")}})},a=function(){if(!$(".navigation").data("cart-check")||""==$(".navigation").data("cart-check"))return!1;$.ajax({url:$(".navigation").data("cart-check"),type:"post",xhrFields:{withCredentials:!0},dataType:"json",success:function(a){a.totalQty&&(a=a.totalQty,addToCart.setCartNum(a)),$("body").trigger("ajaxLoadEnd")},error:function(a,e,t){$("body").trigger("ajaxLoadEnd")}})};function C(a,e){a+="";return""==(a=a.trim())||null==a||"null"==a||"undefined"==a?e:a}function o(a){var e,t=a+"";return""!=(t=t.trim())&&null!=t&&"null"!=t&&"undefined"!=t||(t=""),t=t.replace(/\s\s+/g," "),e="_",a=" ",t=t.split(e).join(a)}(reStockAlert={callReStockAlert:function(a,e){if(!a||!e)return!1;$.ajax({type:"post",url:a,dataType:"html",data:xssfilter(e),success:function(a){$("body").trigger("ajaxLoadEnd"),$("#modal_re_stock_alert").remove(),$("body").append(a),$("#modal_re_stock_alert").modal(),reStockAlert.autoValidationForm(),setTimeout(function(){$("#modal_re_stock_alert").css("display","none").css("display","block")},500)},error:function(a,e,t){$("body").trigger("ajaxLoadEnd"),console.log("status: "+e),console.log("error: "+t)}})},autoValidationForm:function(){$("#modal_re_stock_alert .re-stock-alert-form").on({ajaxLoadBefore:function(a){a.stopPropagation(),$(this).append('<div class="loading-circle"><div class="lds-dual-ring"></div></div>')},ajaxLoadEnd:function(a){a.stopPropagation(),$(this).find(".loading-circle").remove()}}),$("#reStockAlertForm").on({submit:function(a){a.preventDefault(),$("#modal_re_stock_alert .re-stock-alert-form").trigger("ajaxLoadBefore");var e=$(this);e.checkValidation()?(a=e.data("url"),e=e.serialize(),ajax.noCacheCall(a,e,"json",function(a){$("#modal_re_stock_alert .re-stock-alert-form").trigger("ajaxLoadEnd"),a.returnCode?($("#modal_re_stock_alert .re-stock-alert-form").hide(),"00"==(a=a.returnCode)?(dataLayer.push({event:"complete_stock_request_click",superCategory:$("#reStockAlertForm").attr("data-super-category-name"),category:$("#reStockAlertForm").attr("data-category-name"),subcategory:$("#reStockAlertForm").attr("data-sub-category-name"),modelYear:$("#reStockAlertForm").attr("data-model-year"),modelName:$("#reStockAlertForm").attr("data-model-name"),modelCode:$("#reStockAlertForm").attr("data-model-id"),salesModelCode:$("#reStockAlertForm").attr("data-model-salesmodelcode"),sku:$("#reStockAlertForm").attr("data-sku"),suffix:$("#reStockAlertForm").attr("data-model-suffixcode"),bu:$("#reStockAlertForm").attr("data-bu"),price:$("#reStockAlertForm").attr("data-price"),currencyCode:$(".currency-code").val(),dimension185:$(".navigation").attr("data-obs-group"),metric4:$("#reStockAlertForm").attr("data-msrp")}),console.log("complete_stock_request_click"),$("#modal_re_stock_alert .result-success").show()):("01"==a?$("#modal_re_stock_alert .result-duplicate"):$("#modal_re_stock_alert .result-error")).show()):($("#modal_re_stock_alert .re-stock-alert-form").hide(),$("#modal_re_stock_alert .result-error").show())},"post","#modal_re_stock_alert .re-stock-alert-form")):$("#modal_re_stock_alert .re-stock-alert-form").trigger("ajaxLoadEnd")}}),$("#reStockAlertSubmit").click(function(a){a.preventDefault(),$("#reStockAlertForm").trigger("submit")})},init:function(){$("body").off("click.restockalert").on("click.restockalert",".re-stock-alert",function(a){a.preventDefault();var e,t=$(this).data("url"),a={};a.subCategoryName=$(this).data("sub-category-name"),a.categoryName=$(this).data("category-name"),a.superCategoryName=$(this).data("super-category-name"),a.modelYear=$(this).data("model-year"),a.modelName=$(this).data("model-name"),a.modelCode=$(this).data("model-id"),a.salesModelCode=$(this).data("model-salesmodelcode"),a.sku=$(this).data("sku"),a.suffixCode=$(this).data("model-suffixcode"),a.modelId=$(this).data("model-id"),a.bu=$(this).data("bu"),a.price=$(this).data("price"),a.currencyCode=$(".currency-code").val(),a.dimension185=$(".navigation").attr("data-obs-group"),a.metric4=$(this).attr("data-msrp"),0<$(".GPC0009").length&&(e=$(".GPC0009").data("product-id"))!=$(this).data("model-id")?adobeTrackEvent("re-stock-alert",{products:[{sales_model_code:findSalesModel($(this)),model_name:findModelName($(this))}],cross_sell_product:e,page_event:{re_stock_alert:!0}}):adobeTrackEvent("re-stock-alert",{products:[{sales_model_code:findSalesModel($(this)),model_name:findModelName($(this))}],page_event:{re_stock_alert:!0}}),$("body").trigger("ajaxLoadBefore"),reStockAlert.callReStockAlert(t,a)})}}).init(),addToCart={$nav:$(".navigation").eq(0),store:$(".navigation").eq(0).data("store")?$(".navigation").eq(0).data("store"):"default",form:"#addtocartForm",cookieName:"LG5_CartID",cartID:null,url:$("header.navigation")&&$("header.navigation").data("cart-check")?$("header.navigation").data("cart-check"):"/graphql",successMsg:null,preOrderSuccessMsg:null,successBtnAlert:null,successBtnClose:null,successHTML:null,cookieNotice:null,init:function(){this.successMsg=this.$nav.find(".cart").data("alert-success"),this.preOrderSuccessMsg=this.$nav.find(".cart").data("pre-order-success"),this.successBtnAlert=this.$nav.find(".cart").data("alert-btn"),this.successBtnClose=this.$nav.find(".cart").data("close-btn"),this.cookieNotice=this.$nav.find(".cart").data("cookie-notice-msg"),this.$nav.find(".cart").removeAttr("data-alert-btn").removeAttr("data-alert-success").removeAttr("data-close-btn"),"Y"==OBS_LOGIN_FLAG?(addToCart.cartID=getCookie(addToCart.cookieName),addToCart.cartID?(h.getGNBCart(),h.changeCartUrl(addToCart.cartID)):ISSSO):"S"==OBS_LOGIN_FLAG&&a(),c.length&&(0<c.find(".checkAvailable").length?($(document).on("change","#comunaRegionId",$.proxy(h.comunaChange,self)),$(document).on("click",".checkAvailable a.btn-sm",function(a){a.preventDefault(),$("body").trigger("ajaxLoadBefore");a=$(this).closest(".checkAvailable").find(".check-comuna").val();h.checkComuna(a)})):$(document).on("click",".chkStBox a.btn-sm",function(a){a.preventDefault(),$("body").trigger("ajaxLoadBefore");var e=c.find("#pin-modelId").val(),a=$(this).closest(".chkStBox").find(".check-pincode").val();h.checkSale(e,1,a)})),$("body").off("click.addtocart2").on("click.addtocart2",".add-to-cart-multi",function(a){a.preventDefault();a=packageComponent.getMultiModelId();"Y"==OBS_LOGIN_FLAG&&(addToCart.cartID=getCookie(addToCart.cookieName),addToCart.cartID?!c.find("#pin-modelId").val()||0<c.find(".check-good").length?h.addProductToCart(a,1,addToCart.cartID):(c.find(".pdp-info.desktop-info").find("#check-pincode").focus(),c.find(".pdp-info.mobile-bottom-info").find("#check-pincode").focus()):h.createEmptyCart(a))}),$("body").off("click.addtocart").on("click.addtocart",".add-to-cart",function(a){var e=!("button"!=$(this).attr("role")||!OBS_LOGIN_FLAG||"Y"!=OBS_LOGIN_FLAG&&"S"!=OBS_LOGIN_FLAG);e&&a.preventDefault(),r=$(this);var t,d=$(this).data("model-id"),o=$(".addtocart-datelayer-use-flag").val(),a=$(".GPC0009").find("#obsPincodeFlag").val();if(0==$(this).hasClass("in-buynow")&&"Y"!=a&&"Y"!=o&&(0<$(".GPC0009").length&&(t=$(".GPC0009").data("product-id"))!=d?adobeTrackEvent("add-to-cart",{products:[{sales_model_code:findSalesModel($(this)),model_name:findModelName($(this)),value_added_to_cart:findPrice($(this)),units_added_to_cart:findModelCount($(this))}],cross_sell_product:t,page_event:{add_to_cart:!0}}):adobeTrackEvent("add-to-cart",{products:[{sales_model_code:findSalesModel($(this)),model_name:findModelName($(this)),value_added_to_cart:findPrice($(this)),units_added_to_cart:findModelCount($(this))}],page_event:{add_to_cart:!0}})),!e)return!0;if($("body").trigger("ajaxLoadBefore"),"Y"==OBS_LOGIN_FLAG)addToCart.cartID=getCookie(addToCart.cookieName),addToCart.cartID?c.find("#pin-modelId").val()?0<c.find(".check-good").length?h.addProductToCart(d,1,addToCart.cartID,!0,$(this)):(0<c.find(".checkAvailable").length?($("#comunaRegionId").trigger("chosen:activate"),c.find(".check-region").focus()):(0<c.find(".delivery-list .option-list").length&&$("#pinCodeList").trigger("chosen:activate"),c.find(".check-pincode").focus()),$("body").trigger("ajaxLoadEnd")):"Y"==o?h.addProductToCart(d,1,addToCart.cartID,!0,$(this)):h.addProductToCart(d,1,addToCart.cartID):h.createEmptyCart(d);else{if("S"!=OBS_LOGIN_FLAG)return console.log("error!"),!0;i(d,1)}})},setCartNum:function(a){0<a?100<=a?addToCart.$nav.find(".for-mobile .right .cart .count, .for-desktop .right-btm .icons .cart .count").html("99+"):addToCart.$nav.find(".for-mobile .right .cart .count, .for-desktop .right-btm .icons .cart .count").html(a):addToCart.$nav.find(".for-mobile .right .cart .count, .for-desktop .right-btm .icons .cart .count").html("")},currentFocus:function(){r&&r.closest(".component").hasClass("GPC0003")&&r.closest(".item").addClass("on-focus"),r&&r.focus()}},"Y"==OBS_LOGIN_FLAG&&ISMAIN&&ISMS||"Y"==OBS_LOGIN_FLAG&&ISSSO||addToCart.init(),OBS={timeOut:5e3,useCookie:!0,url:addToCart.$nav.data("cart-check"),authToken:h.getToken(),cookieName:"LG5_ExcitingOffer",init:function(a){var e=getCookie(OBS.cookieName),t="";e&&""!=e&&(t=OBS.findCookieValue("ORDER")),"Y"==OBS_LOGIN_FLAG?(a.trigger("ajaxLoadBefore"),t?OBS.doSubmit(a,t):OBS.getOrderHistory(a)):(OBS_LOGIN_FLAG,a.trigger("ajaxLoadBefore"),OBS.doSubmit(a,""))},findCookieValue:function(a){var e=getCookie(OBS.cookieName),t={};if(e&&-1!=e.indexOf(a))if(-1!=e.indexOf(","))for(var d=e.split(","),o=0;o<d.length;o++)t[d[o].split(":")[0]]=d[o].split(":")[1];else{e=e;t[e.split(":")[0]]=e.split(":")[1]}return t[a]||""},addCookieValue:function(a,e){var t=getCookie(OBS.cookieName),d={};if(t&&-1!=t.indexOf(a))if(-1!=t.indexOf(","))for(var o=t.split(","),r=0;r<o.length;r++)d[o[r].split(":")[0]]=o[r].split(":")[1];else{var i=t;d[i.split(":")[0]]=i.split(":")[1]}d[a]=e,console.log(d),t="",$.each(d,function(a,e){t=""==t?t+a+":"+e:t+","+a+":"+e}),setCookie(OBS.cookieName,t)},delCookieValue:function(){removeCookie(OBS.cookieName,!0)},doSubmit:function(a,e){e&&a.find("form input[name=purchaseModelId]").val(e);var t=getCookie(OBS.cookieName);t&&""!=t&&(cartProduct=OBS.findCookieValue("CART"));e="",t=getCookie("LG5_CompareCart");t&&(e=-1!=t.indexOf("|")?t.split("|")[0]:t,a.find("form input[name=compareModelId]").val(e));t="",e=getCookie("LG5_RecentlyView");e&&(t=-1!=e.indexOf("|")?e.split("|")[0]:e,a.find("form input[name=recentlyModelId]").val(t)),a.find("form").submit()},getOrderHistory:function(d){var a;OBS.authToken?((a={}).Authorization="Bearer "+OBS.authToken,a.Store=addToCart.$nav.data("store"),a["Content-type"]="application/json",$.ajax({url:OBS.url,headers:a,type:"post",data:JSON.stringify({query:"{customerOrders(pageSize: 2 currentPage: 1) {items {id increment_id created_at status billing_address {firstname lastname postcode street city region {region_code} country_id telephone} shipping_address {firstname lastname postcode street city region {region_code} country_id telephone} items {sku qty_ordered price}}}}",variables:null,operationName:null}),dataType:"json",timeout:OBS.timeOut,success:function(a){var e,t;null!=a.data.customerOrders&&0<(e=a.data.customerOrders.items.length)&&0<(t=a.data.customerOrders.items[e-1].items.length)?(t=a.data.customerOrders.items[e-1].items[t-1].sku,OBS.addCookieValue("ORDER",t),OBS.doSubmit(d,t)):OBS.doSubmit(d,"")},error:function(a,e,t){OBS.doSubmit(d,"")}})):OBS.doSubmit(d,"")}},$("body").on("click",".add-to-cart",function(){var a=$(this),e="",t="",e=a.attr("data-price");$(a).closest(".GPC0011").length&&(a=$(".GPC0009").find(".button a.add-to-cart")),t=$(".match-product-list").length?o(a.parents(".product-summary").find(".user-friendly-name").text()):$(".GPC0009").length?o($(".pdp-summary-area .pdp-info.desktop-info").find(".model-title").text()):o(a.parents(".item").find(".model-name").text()),"."!=a.attr("data-price")&&".00"!=a.attr("data-price")&&"0.0"!=a.attr("data-price")&&"0"!=a.attr("data-price")||(e="");var d=a.attr("data-msrp");"."!=a.attr("data-msrp")&&".00"!=a.attr("data-msrp")&&"0.0"!=a.attr("data-msrp")&&"0"!=a.attr("data-msrp")||(d=""),ga360Init={event:"addToCart",pageType:$(".GPC0009").length?"pdp":"nonPdp",displayName:t,siteType:"undefined"==typeof standardData?"":standardData.siteType,std_lv1:a.attr("data-buname-one"),std_lv2:a.attr("data-buname-two"),std_lv3:a.attr("data-buname-three"),price:e,pagePurpose:_dl.page_name.page_purpose,sku:a.attr("data-sku"),bu:a.attr("data-buname-one"),country_code:_dl.country_code,page_category_l1:_dl.page_category_l1,page_category_l2:_dl.page_category_l2,page_category_l3:_dl.page_category_l3,page_category_l4:_dl.page_category_l4,language:_dl.language_code,superCategory:a.attr("data-super-category-name"),primaryCategory:_dl.page_name.category,subCategory:_dl.page_name.sub_category,name:a.attr("data-model-salesmodelcode"),modelCode:a.attr("data-model-id"),productDetailArray:new Array,currencyCode:$(".currency-code").val(),quantity:0,cartID:new Object,ecommerce:new Object,obsGroup:$(".navigation").attr("data-obs-group"),metric4:d,cart_btn:"Y",init:function(){},addData:function(){dataLayer.push({event:ga360Init.event,siteType:C(ga360Init.siteType,"B2C"),pagePurpose:C(ga360Init.pagePurpose,ga360Init.pageType),ecommerce:ga360Init.ecommerce,cartID:ga360Init.cartID})}},a.hasClass("pre-order")||"Y"==a.closest(".GPC0009").data("track-event-flag")&&a.closest(".GPC0009").length&&!a.closest(".GPC0009").find(".check-good").length&&adobeTrackEvent("add_to_cart_click_additional",{level1:standardData.level1,level2:standardData.level2,level3:standardData.level3,sales_model_code:_dl.products[0].sales_model_code,model_name:_dl.products[0].model_name,bu:_dl.page_name.bu,page_event:{add_to_cart_click_additional:!0}})})});
//# sourceMappingURL=maps/add-to-cart.min.js.map